<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Assessing prediction uncertainty with the bootstrap • safepredict</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../tidyverse-2.css" rel="stylesheet">
<meta property="og:title" content="Assessing prediction uncertainty with the bootstrap">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-115082821-1');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">safepredict</a>
        <div class="info">
          <span class="partof">part of <a href="https://github.com/tidymodels">tidymodels</a></span>
          <span class="version version-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9001</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/bootstrapping.html">Assessing prediction uncertainty with the bootstrap</a>
    </li>
    <li>
      <a href="../articles/contributing.html">How to contribute new methods</a>
    </li>
    <li>
      <a href="../articles/intervals.html">Confidence vs predictive intervals</a>
    </li>
    <li>
      <a href="../articles/novel-factor-levels.html">Handling novel factor levels</a>
    </li>
    <li>
      <a href="../articles/yardstick.html">Tidy workflows using yardstick and tidyposterior</a>
    </li>
  </ul>
</li>
        <li>
  <a href="https://github.com/alexpghayes/safepredict">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Assessing prediction uncertainty with the bootstrap</h1>
                        <h4 class="author">Alex Hayes</h4>
            
            <h4 class="date">2018-12-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/alexpghayes/safepredict/blob/master/vignettes/bootstrapping.Rmd"><code>vignettes/bootstrapping.Rmd</code></a></small>
      <div class="hidden name"><code>bootstrapping.Rmd</code></div>

    </div>

    
    
<p>This vignette walks demonstrates how to estimate uncertainty in predictions via the bootstrap. We use <a href="https://tidymodels.github.io/rsample/"><code>rsample</code></a> throughout. First we show how to calculate confidence intervals, and then how to calculate predictive intervals. If you are unfamiliar with the difference between these two, we highly recommend that you read <code><a href="../articles/intervals.html">vignette("intervals", package = "safepredict")</a></code>.</p>
<p>Throughout this vignette we use the nonparametric bootstrap, which is more robust than the parametric bootstrap and does not require us to assumption that we have a correctly specified model. The parametric bootstrap will give you tighter intervals than the procedures we outline here, but we recommend against this unless you are <em>very, very</em> certain that you have correctly specified your model.</p>
<p>This vignette assumes you are interested in a continuous outcome.</p>
<div id="bootstrapped-confidence-intervals" class="section level2">
<h2 class="hasAnchor">
<a href="#bootstrapped-confidence-intervals" class="anchor"></a>Bootstrapped confidence intervals</h2>
<p>Let <span class="math inline">\(X\)</span> be the original data (containing both predictors and outcome).</p>
<ol style="list-style-type: decimal">
<li>Sample the rows of <span class="math inline">\(X\)</span> with replacement <span class="math inline">\(1, ..., B\)</span> times to create bootstrapped data sets <span class="math inline">\(X_1^*, ..., X_B^*\)</span>.</li>
<li>Fit your model of choice on each bootstrapped data set and obtain fits <span class="math inline">\(\hat f_1, ..., \hat f_B\)</span>.</li>
<li>Predict the mean at <span class="math inline">\(X\)</span> with each <span class="math inline">\(\hat f_i\)</span> to get samples from the sampling distribution of <span class="math inline">\(f(X)\)</span>.</li>
<li>Look at the appropriate quantiles of <span class="math inline">\(f(X)\)</span>. You’re done!</li>
</ol>
<p>Let’s work through an example, using <code>glmnet</code> for a binary classification problem. Our goal will be to predict <code>Attrition</code> based on 30 predictors variables.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(rsample)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">27</span>)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">attrition &lt;-<span class="st"> </span>attrition <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">500</span>)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw">glimpse</span>(attrition)</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#&gt; Observations: 500</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co">#&gt; Variables: 31</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">#&gt; $ Age                      &lt;int&gt; 32, 51, 33, 31, 31, 50, 50, 33, 27, 5...</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">#&gt; $ Attrition                &lt;fct&gt; No, No, No, Yes, No, No, No, No, No, ...</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">#&gt; $ BusinessTravel           &lt;fct&gt; Travel_Rarely, Travel_Rarely, Travel_...</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="co">#&gt; $ DailyRate                &lt;int&gt; 234, 684, 867, 1365, 798, 691, 1115, ...</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co">#&gt; $ Department               &lt;fct&gt; Sales, Research_Development, Research...</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co">#&gt; $ DistanceFromHome         &lt;int&gt; 1, 6, 8, 13, 7, 2, 1, 3, 1, 3, 4, 24,...</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="co">#&gt; $ Education                &lt;ord&gt; Master, Bachelor, Master, Master, Col...</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="co">#&gt; $ EducationField           &lt;fct&gt; Medical, Life_Sciences, Life_Sciences...</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="co">#&gt; $ EnvironmentSatisfaction  &lt;ord&gt; Medium, Low, Very_High, Medium, High,...</span></a>
<a class="sourceLine" id="cb1-21" data-line-number="21"><span class="co">#&gt; $ Gender                   &lt;fct&gt; Male, Male, Male, Male, Female, Male,...</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="co">#&gt; $ HourlyRate               &lt;int&gt; 68, 51, 90, 46, 48, 64, 73, 56, 60, 4...</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="co">#&gt; $ JobInvolvement           &lt;ord&gt; Medium, High, Very_High, High, Medium...</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24"><span class="co">#&gt; $ JobLevel                 &lt;int&gt; 1, 5, 1, 2, 3, 4, 5, 1, 2, 4, 5, 2, 2...</span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25"><span class="co">#&gt; $ JobRole                  &lt;fct&gt; Sales_Representative, Research_Direct...</span></a>
<a class="sourceLine" id="cb1-26" data-line-number="26"><span class="co">#&gt; $ JobSatisfaction          &lt;ord&gt; Medium, High, Low, Low, High, High, M...</span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27"><span class="co">#&gt; $ MaritalStatus            &lt;fct&gt; Married, Single, Married, Divorced, M...</span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="co">#&gt; $ MonthlyIncome            &lt;int&gt; 2269, 19537, 3143, 4233, 8943, 17639,...</span></a>
<a class="sourceLine" id="cb1-29" data-line-number="29"><span class="co">#&gt; $ MonthlyRate              &lt;int&gt; 18024, 6462, 6076, 11512, 14034, 6881...</span></a>
<a class="sourceLine" id="cb1-30" data-line-number="30"><span class="co">#&gt; $ NumCompaniesWorked       &lt;int&gt; 0, 7, 6, 2, 1, 5, 3, 1, 5, 3, 2, 2, 1...</span></a>
<a class="sourceLine" id="cb1-31" data-line-number="31"><span class="co">#&gt; $ OverTime                 &lt;fct&gt; No, No, No, No, No, No, Yes, Yes, No,...</span></a>
<a class="sourceLine" id="cb1-32" data-line-number="32"><span class="co">#&gt; $ PercentSalaryHike        &lt;int&gt; 14, 13, 19, 17, 24, 16, 19, 11, 19, 1...</span></a>
<a class="sourceLine" id="cb1-33" data-line-number="33"><span class="co">#&gt; $ PerformanceRating        &lt;ord&gt; Excellent, Excellent, Excellent, Exce...</span></a>
<a class="sourceLine" id="cb1-34" data-line-number="34"><span class="co">#&gt; $ RelationshipSatisfaction &lt;ord&gt; Medium, High, Medium, High, Low, Very...</span></a>
<a class="sourceLine" id="cb1-35" data-line-number="35"><span class="co">#&gt; $ StockOptionLevel         &lt;int&gt; 1, 0, 1, 0, 1, 0, 0, 0, 1, 3, 1, 0, 0...</span></a>
<a class="sourceLine" id="cb1-36" data-line-number="36"><span class="co">#&gt; $ TotalWorkingYears        &lt;int&gt; 3, 23, 14, 9, 10, 30, 28, 8, 6, 21, 2...</span></a>
<a class="sourceLine" id="cb1-37" data-line-number="37"><span class="co">#&gt; $ TrainingTimesLastYear    &lt;int&gt; 2, 5, 1, 2, 2, 3, 1, 3, 1, 5, 2, 3, 2...</span></a>
<a class="sourceLine" id="cb1-38" data-line-number="38"><span class="co">#&gt; $ WorkLifeBalance          &lt;ord&gt; Better, Better, Better, Bad, Better, ...</span></a>
<a class="sourceLine" id="cb1-39" data-line-number="39"><span class="co">#&gt; $ YearsAtCompany           &lt;int&gt; 2, 20, 10, 3, 10, 4, 8, 8, 2, 5, 1, 5...</span></a>
<a class="sourceLine" id="cb1-40" data-line-number="40"><span class="co">#&gt; $ YearsInCurrentRole       &lt;int&gt; 2, 18, 8, 1, 9, 3, 3, 7, 2, 3, 0, 4, ...</span></a>
<a class="sourceLine" id="cb1-41" data-line-number="41"><span class="co">#&gt; $ YearsSinceLastPromotion  &lt;int&gt; 2, 15, 7, 1, 8, 0, 0, 3, 2, 1, 0, 1, ...</span></a>
<a class="sourceLine" id="cb1-42" data-line-number="42"><span class="co">#&gt; $ YearsWithCurrManager     &lt;int&gt; 2, 15, 6, 2, 9, 3, 7, 0, 0, 3, 0, 4, ...</span></a></code></pre></div>
<p>Since we’re using <code>glmnet</code>, we have to start with a bunch of preprocessing. The <code>recipes</code> package makes this sane.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(recipes)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">rec &lt;-<span class="st"> </span><span class="kw">recipe</span>(Attrition <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> attrition) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="st">  </span><span class="kw">step_center</span>(<span class="kw">all_numeric</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="st">  </span><span class="kw">step_scale</span>(<span class="kw">all_numeric</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="st">  </span><span class="kw">step_dummy</span>(<span class="kw">all_nominal</span>(), <span class="op">-</span>Attrition) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="st">  </span><span class="kw">prep</span>()</a>
<a class="sourceLine" id="cb2-8" data-line-number="8"></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">rec</a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt; Data Recipe</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">#&gt; Inputs:</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt;       role #variables</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt;    outcome          1</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt;  predictor         30</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co">#&gt; Training data contained 500 data points and no missing data.</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="co">#&gt; Operations:</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="co">#&gt; Centering for Age, DailyRate, ... [trained]</span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"><span class="co">#&gt; Scaling for Age, DailyRate, ... [trained]</span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24"><span class="co">#&gt; Dummy variables from BusinessTravel, Department, ... [trained]</span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25"></a>
<a class="sourceLine" id="cb2-26" data-line-number="26">x &lt;-<span class="st"> </span><span class="kw">juice</span>(rec, <span class="kw">all_predictors</span>(), <span class="dt">composition =</span> <span class="st">"matrix"</span>)</a>
<a class="sourceLine" id="cb2-27" data-line-number="27">y &lt;-<span class="st"> </span><span class="kw">juice</span>(rec, <span class="kw">all_outcomes</span>())<span class="op">$</span>Attrition</a></code></pre></div>
<p>We can now fit an L1 penalized logistic regression model, and use <code><a href="../reference/safe_predict.html">safe_predict()</a></code> to calculate residuals.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(glmnet)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(safepredict)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">fit &lt;-<span class="st"> </span><span class="kw">cv.glmnet</span>(x, y, <span class="dt">family =</span> <span class="st">"binomial"</span>)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">pred &lt;-<span class="st"> </span><span class="kw"><a href="../reference/safe_predict.html">safe_predict</a></span>(fit, x, <span class="dt">type =</span> <span class="st">"prob"</span>)</a></code></pre></div>
<p>Let’s take a quick look to sanity check our work. We’ll plot the estimated probability of attrition versus scaled distanced from home.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">x <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="st">  </span><span class="kw">bind_cols</span>(pred) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(DistanceFromHome, .pred_Yes)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="st">  </span><span class="kw">theme_bw</span>()</a></code></pre></div>
<p><img src="bootstrapping_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>This passes the sanity check, we proceed to the bootstrapping.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(purrr)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyr)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">boots &lt;-<span class="st"> </span><span class="kw">bootstraps</span>(attrition, <span class="dt">times =</span> <span class="dv">10</span>, <span class="dt">strata =</span> <span class="st">"Attrition"</span>)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">fits &lt;-<span class="st"> </span>boots <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">    <span class="dt">prepped =</span> <span class="kw">map</span>(splits, prepper, rec),</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">    <span class="dt">x_train =</span> <span class="kw">map</span>(prepped, <span class="op">~</span><span class="kw">juice</span>(.x, <span class="kw">all_predictors</span>(), <span class="dt">composition =</span> <span class="st">"matrix"</span>)),</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">    <span class="dt">y_train =</span> <span class="kw">map</span>(prepped, <span class="op">~</span><span class="kw">juice</span>(.x, <span class="kw">all_outcomes</span>())<span class="op">$</span>Attrition),</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">    <span class="dt">model =</span> <span class="kw">map2</span>(x_train, y_train, cv.glmnet, <span class="dt">family =</span> <span class="st">"binomial"</span>)</a>
<a class="sourceLine" id="cb5-12" data-line-number="12">  )</a></code></pre></div>
<p>Next we get predictions for each bootstrapped fit</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">boot_preds &lt;-<span class="st"> </span>fits <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">    <span class="dt">preds =</span> <span class="kw">map</span>(model, safe_predict, x, <span class="dt">type =</span> <span class="st">"prob"</span>),</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">    <span class="dt">preds =</span> <span class="kw">map</span>(preds, add_id_column)</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="st">  </span><span class="kw">unnest</span>(preds, <span class="dt">.id =</span> <span class="st">"model"</span>)</a></code></pre></div>
<p>and all that remains to calculate a 90 percent confidence interval is to look at the quantiles of the bootstrapped fits:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">pred_ci &lt;-<span class="st"> </span>boot_preds <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(.id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">    <span class="dt">.pred_Yes_lower =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/quantile">quantile</a></span>(.pred_Yes, <span class="fl">0.05</span>),</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">    <span class="dt">.pred_Yes_upper =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/quantile">quantile</a></span>(.pred_Yes, <span class="fl">0.95</span>)</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="st">  </span><span class="kw">bind_cols</span>(pred) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>.pred_No)</a>
<a class="sourceLine" id="cb7-9" data-line-number="9"></a>
<a class="sourceLine" id="cb7-10" data-line-number="10">pred_ci</a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt; # A tibble: 500 x 4</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt;      .id .pred_Yes_lower .pred_Yes_upper .pred_Yes</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt;    &lt;int&gt;           &lt;dbl&gt;           &lt;dbl&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt;  1     1          0.158           0.160     0.160 </span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt;  2     2          0.0260          0.0549    0.0261</span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co">#&gt;  3     3          0.0357          0.0609    0.0359</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co">#&gt;  4     4          0.121           0.150     0.149 </span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18"><span class="co">#&gt;  5     5          0.0585          0.0812    0.0587</span></a>
<a class="sourceLine" id="cb7-19" data-line-number="19"><span class="co">#&gt;  6     6          0.0335          0.0858    0.0334</span></a>
<a class="sourceLine" id="cb7-20" data-line-number="20"><span class="co">#&gt;  7     7          0.232           0.244     0.242 </span></a>
<a class="sourceLine" id="cb7-21" data-line-number="21"><span class="co">#&gt;  8     8          0.134           0.179     0.134 </span></a>
<a class="sourceLine" id="cb7-22" data-line-number="22"><span class="co">#&gt;  9     9          0.170           0.263     0.262 </span></a>
<a class="sourceLine" id="cb7-23" data-line-number="23"><span class="co">#&gt; 10    10          0.111           0.191     0.111 </span></a>
<a class="sourceLine" id="cb7-24" data-line-number="24"><span class="co">#&gt; # ... with 490 more rows</span></a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#bootstrapped-confidence-intervals">Bootstrapped confidence intervals</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="tidyverse">
  <p>probably is a part of the <strong>tidymodels</strong> ecosystem, a collection of modeling packages designed with common APIs and a shared philosophy.</p>
</div>

<div class="author">
  <p>
    Developed by Alex Hayes.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>
      </footer>
</div>

  

  </body>
</html>
